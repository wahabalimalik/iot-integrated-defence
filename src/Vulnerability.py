"""
This module contains vulnerability object and relevant functions.

@author: Mengmeng Ge
"""

from Node import *
from Network import *


class vulNode(node):
    """
    Create vulnerability object.
    """
    def __init__(self, name):
        super(vulNode, self).__init__(name)
        
        #Initialize privilege value
        self.privilege = None
        #Initialize value for input of the HARM
        self.val = 0
        #Initialize name
        self.name = name
        #Indicate whether patchable (p) or non-patchable (np)
        self.type = None
        # Indicate the severity of the vulnerability based on the metrics
        self.severity = None
        # Indicate the cost of the vulnerability based on the metrics
        self.cost = None
        # Indicate the base value of the vulnerability based on the metrics
        self.base = None
        # Indicate the impact of the vulnerability based on the metrics
        self.impact = None
        # Indicate the exploitability of the vulnerability based on the metrics
        self.exploitability = None


    def __str__(self):
        return self.name

    def createVul(self, node, metricValue, pri, cost=False, bs=False, impact=False, exploitability=False):
        """
        Create vulnerability network for node.
    
        :param node: node in the network which has vulnerabilities
        :param metricValue: assign a metric value to vulnerability (e.g. attack probability)
        :param pri: assign privilege value to vulnerability
        :param cost: assign cost
        :param bs: assign base value to vulnerability
        :param impact: assign impact value to vulnerability
        :param exploitability: assign exploitability value to vulnerability
        :returns: none
        """
        
        #Instantiate vulnerability parameters
        
        self.val = metricValue
        self.privilege = pri
        self.cost = cost
        self.base = bs
        self.impact = impact
        self.exploitability = exploitability

        #Create a vulnerability network for the node
        if node.vul is None:
            node.vul = network()
            
        #Add vulnerability into the vulnerability network of node
        node.vul.nodes.append(self)
        
        return None


    def thresholdPri(self, node, t):
        """
        Set start point for the vulnerability network and link vulnerabilities to the start point.
        
        :param node: node in the network which has vulnerabilities
        :param t: privilege value for the start point
        :returns None
        """
        
        node.vul.s = vulNode('s')
        s = node.vul.s    
        del s.con[:]
        for v in node.vul.nodes:
            if v.privilege <= t:
                s.con.append(v)        
        return None
    
    
    def terminalPri(self, node, t):
        """
        Set end point for the vulnerability network and link vulnerabilities to the end point.
        
        :param node: node in the network which has vulnerabilities
        :param t: privilege value for the end point
        :returns None
        """
        
        node.vul.e = vulNode('e')
        e = node.vul.e
        del e.con[:]
        for v in node.vul.nodes:
            if v.privilege >= t:
                v.con.append(e)
        return None

